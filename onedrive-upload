#!/bin/bash

script_base_folder=$(dirname "$0")
source "${script_base_folder}/onedrive.cfg"
source "${script_base_folder}/onedrive-base"

if [ -z "$1" ]; then
        echo "Please specify at least one file to upload"
        exit 1
fi

api_access_token=$(acquireAccessToken)
exit_on_error

for current_file in "$@"; do
        echo -n "Uploading '${current_file}'..."
        current_filename=$(basename "${current_file}")
        current_url="${api_upload_url}/${api_folder_id}/files/${current_filename}?access_token=${api_access_token}"

        status_code=$(curl -o /dev/null -w "%{http_code}" -s -T "${current_file}" "${current_url}")
        if (( ${status_code} == 200 || ${status_code} == 201 )); then
            echo "Done"
        else
            echo "Failure (Code: ${status_code})"
        fi
done
